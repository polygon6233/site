/* SCEditor v2.1.3 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){"use strict";sceditor.plugins.undo=function(){var o,r,e=this,u=0,n=50,a=[],c=[],d=!1,s=function(e){d=!0,r=e.value,o.sourceMode(e.sourceMode),o.val(e.value,!1),o.focus(),e.sourceMode?o.sourceEditorCaret(e.caret):o.getRangeHelper().restoreRange(),d=!1};e.init=function(){n=(o=this).undoLimit||n,o.addShortcut("ctrl+z",e.undo),o.addShortcut("ctrl+shift+z",e.redo),o.addShortcut("ctrl+y",e.redo),o.commands.undo||(o.commands.undo={txtExec:e.undo,exec:e.undo,tooltip:"Undo"},o.commands.redo={txtExec:e.redo,exec:e.redo,tooltip:"Redo"})},e.undo=function(){var e=c.pop(),t=o.val(null,!1);return e&&!a.length&&t===e.value&&(e=c.pop()),e&&(a.length||a.push({caret:o.sourceEditorCaret(),sourceMode:o.sourceMode(),value:t}),a.push(e),s(e)),!1},e.redo=function(){var e=a.pop();return c.length||(c.push(e),e=a.pop()),e&&(c.push(e),s(e)),!1},e.signalReady=function(){var e,t=o.val(null,!1);e=""===t?{end:0,start:0}:this.sourceEditorCaret(),r=t,c.push({caret:e,sourceMode:this.sourceMode(),value:t})},e.signalValuechangedEvent=function(e){var t=e.detail.rawValue;0<n&&c.length>n&&c.shift(),!d&&r&&r!==t&&(a.length=0,(u+=function(e,t){var o,r,u,n,a=e.length,c=t.length,d=Math.max(a,c);for(o=0;o<d&&e.charAt(o)===t.charAt(o);o++);for(u=a<c?c-a:0,n=c<a?a-c:0,r=d-1;0<=r&&e.charAt(r-u)===t.charAt(r-n);r--);return r-o+1}(r,t))<20||u<50&&!/\s$/g.test(e.rawValue)||(c.push({caret:o.sourceEditorCaret(),sourceMode:o.sourceMode(),value:t}),u=0,r=t))}}}();